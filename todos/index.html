<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    .done {
        background-color: green;

    }
</style>

<body>
    <h1>To Do List</h1>
    <button onclick="CreateNewLink();">Share</button><br>
    <hr>

    <input id="inpA" type="text" onkeydown="AddItem()" placeholder="Add item and hit enter" />


    <ul id="ulItems">
    </ul>

    <script>


        function AddItem() {

            if (event.key === 'Enter') {


                var x = document.getElementById("inpA").value;
                if (x.indexOf(",") === -1) {

                    if (items.findIndex(i => i.name == x) == -1) {


                        items.push(new ToDo(x, 0));
                        BuildLis(x, 0)

                        document.getElementById("inpA").value = "";
                        document.getElementById("inpA").focus();
                    } else {
                        alert(`${x} is already added`)
                        document.getElementById("inpA").value = "";
                        document.getElementById("inpA").focus();
                    }
                } else {
                    alert("Commas not allowed.");
                    document.getElementById("inpA").value = "";
                    document.getElementById("inpA").focus();
                }

            }
        }

        function BuildLis(x, status) {

            var li = document.createElement('li');

            if (status) {
                li.classList.add("done");
            }

            if (status) {

                li.innerHTML = `${x}<input type="checkbox" checked id="${x}" onclick="toggleMe(this)"> <button id="${x}"
                onclick="DeleteItem(this)" style="color: red;">x</button>`;
            } else {

                li.innerHTML = `${x}<input type="checkbox" id="${x}" onclick="toggleMe(this)"> <button  id="${x}"
                onclick="DeleteItem(this)" style="color: red;">x</button>`;
            }

            var ul = document.getElementById("ulItems");
            ul.appendChild(li);
        }

        function toggleMe(e) {
            e.parentElement.classList.toggle("done");
            var x = items.filter(x => x.name == e.id)
            if (x[0].status == 0) {
                x[0].status = 1;
            } else {
                x[0].status = 0;
            }
        }

        function DeleteItem(e) {
            var xx = items.findIndex(x => x.name == e.id);
            delete items[xx]
            items = items.filter(Boolean);
            var parent = e.parentElement;
            parent.remove();
        }

        class ToDo {
            constructor(name, status) {
                this.name = name;
                this.status = status;
            }
        }
        var items = [];
        (function () {
            var x = getQueryStrings();
            var pending = [];
            var done = [];
            try {
                pending = x["p"].split(",").filter(x => x.trim().length != 0);
                done = x["d"].split(",").filter(x => x.trim().length != 0);

                for (var i = 0; i < pending.length; i++) {
                    BuildLis(pending[i], 0);
                }
                for (var i = 0; i < done.length; i++) {
                    BuildLis(done[i], 1);
                }

                for (var i = 0; i < pending.length; i++) {
                    var item = new ToDo(pending[i], 0);
                    items.push(item);
                }
                for (var i = 0; i < done.length; i++) {
                    var item = new ToDo(done[i], 1);
                    items.push(item);
                }
            } catch (error) {
            }
        })();

        function getQueryStrings() {
            var assoc = {};
            var decode = function (s) { return decodeURIComponent(s.replace(/\+/g, " ")); };
            var queryString = location.search.substring(1);
            var keyValues = queryString.split('&');

            for (var i in keyValues) {
                var key = keyValues[i].split('=');
                if (key.length > 1) {
                    assoc[decode(key[0])] = decode(key[1]);
                }
            }
            return assoc;
        }

        function CreateNewLink() {
            var done = items.filter(x => x.status == 1);
            var pending = items.filter(x => x.status == 0);
            var d = "";
            for (var i = 0; i < done.length; i++) {
                if (done[i].name.trim().length != 0) {
                    d += done[i].name.trim() + ","
                }
            }
            d = d.slice(0, -1);
            var p = "";
            for (var i = 0; i < pending.length; i++) {
                if (pending[i].name.trim().length != 0) {
                    p += pending[i].name.trim() + ","
                }
            }
            p = p.slice(0, -1);
            alert(`/index.html?d=${d}&p=${p}`);
        }
    </script>
</body>

</html>